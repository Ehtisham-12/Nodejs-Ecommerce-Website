<%- include('includes/head') %>
<body>
    <div class="container">
        <%- include('includes/navigation') %>
        <!-- Product Section -->
        <div class="product-container">

            <div class="featured-product">
                <h2>Featured Products</h2>
            </div>

            <div class="product-main-container">
                <% product.forEach(item=> { %>
                    <div class="product-card" data-id="<%= item._id %>">

                        <div class="product-img">
                            <img src="<%=item.images[0].url%>" alt="">
                        </div>

                        <div class="product-title">
                            <h4>
                                <%=item.name%>
                            </h4>
                        </div>

                        <div class="product-stars">
                            <span class="start customer-star-div" data-id="<%=item.rating%>">
                                <i class="fa-solid fa-star" data-id="1"></i>
                                <i class="fa-solid fa-star" data-id="2"></i>
                                <i class="fa-solid fa-star" data-id="3"></i>
                                <i class="fa-solid fa-star" data-id="4"></i>
                                <i class="fa-solid fa-star" data-id="5"></i>

                            </span>
                            <span class="review-count">
                                (<%=item.numOfReviews%> Reviews)
                            </span>
                        </div>
                        <div class="product-price">
                            <h3>$<%=item.price%>
                            </h3>
                        </div>
                    </div>
                    <% }) %>



            </div>
        </div>
    </div>
    <%- include('includes/footer') %>
    
    <script>

        const hamburger = document.querySelector('.nav-hamburger');
        const navList = document.querySelector('.nav-list-container');

        hamburger.addEventListener('click', () => {
            navList.classList.toggle('active');
        })

        const user = document.querySelector('.user-profile-nav');

        user.addEventListener('mouseover', () => {
            document.querySelector('.main-user-profile-nav').classList.add('active');
        })
        user.addEventListener('mouseout', () => {
            document.querySelector('.main-user-profile-nav').classList.remove('active');
        })


        const userProfile = document.querySelector('.user-profile');
        function homePageUser() {
            if (document.cookie) {
                userProfile.style.display = 'block';
                fetch('/homeUser', {
                    method: 'get',
                    headers: {
                        "Content-Type": "application/json"
                    },
                })
                    .then((res) => res.json())
                    .then((data) => {
                        const adminOnly = document.querySelector('.admin-only');
                        const userProfileImg = document.querySelector('.user-profile-img img');

                        userProfileImg.src = data.user.picture;
                        if (data.user.role === 'user') {
                            adminOnly.style.display = 'none';
                        }
                        if (data.user.role === 'admin') {
                            adminOnly.style.display = 'block';
                        }
                    })

                fetch('/total/delivered')
                    .then(res => res.json())
                    .then(result => {
                        if (result.totalItems <= 0) {
                            notification.forEach(item => {
                                item.style.display = 'none';
                            })
                        }
                        if (result.totalItems > 0) {
                            notification.forEach(item => {
                                item.style.display = 'block';
                                item.querySelector('p').textContent = result.totalItems;
                            })
                        }

                    })
            } else {
                userProfile.style.display = 'none';
            }
        }
        homePageUser();

        // Delivery Notification 
        const notification = document.querySelectorAll('.notification-number');
        const totalNotification = document.querySelectorAll('.notification-number p');

        // notification.forEach(item => {
        //     item.style.display = 'none';
        // })


        const productCard = document.querySelectorAll('.product-card');

        productCard.forEach(item => {
            item.addEventListener('click', () => {
                let productId = item.getAttribute('data-id');
                window.location = `/product/${productId}`;

            })
        })


        // Show product Overall rating

        let avgStar = document.querySelectorAll('.customer-star-div');

        avgStar.forEach(item => {
            let itemStar = item.querySelectorAll('i');
            itemStar.forEach(star => {
                if (star.dataset.id <= item.dataset.id) {
                    star.style.color = 'orange';
                }
            })
        });


    </script>
</body>
</html>

